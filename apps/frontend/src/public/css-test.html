<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSS Debug Test</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      .test-card {
        border: 1px solid #ccc;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      pre {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
      }
      .status-good {
        color: #10b981;
      }
      .status-bad {
        color: #ef4444;
      }
      .status-warn {
        color: #f59e0b;
      }
    </style>
  </head>
  <body>
    <h1>üîç CSS Debug Test Page</h1>
    <p>This page analyzes CSS loading for Fancy Trader</p>

    <div class="test-card">
      <h2>Test Results</h2>
      <div id="results">Loading...</div>
    </div>

    <div class="test-card">
      <h2>Detailed Analysis</h2>
      <pre id="details">Analyzing...</pre>
    </div>

    <div class="test-card">
      <h2>Actions</h2>
      <button onclick="location.reload()">Refresh Test</button>
      <button onclick="fetchMainCSS()">Fetch Main CSS</button>
      <button onclick="copyResults()">Copy Results</button>
    </div>

    <script>
      const results = {
        timestamp: new Date().toISOString(),
        location: window.location.href,
        stylesheets: [],
        cssFiles: [],
        totalRules: 0,
        tailwindDetected: false,
        status: "unknown",
      };

      function analyzeCSS() {
        console.log("üîç Starting CSS analysis...");

        // Analyze all stylesheets
        Array.from(document.styleSheets).forEach((sheet, idx) => {
          try {
            const info = {
              index: idx,
              href: sheet.href || "inline",
              rules: sheet.cssRules?.length || 0,
              disabled: sheet.disabled,
              firstRules: [],
            };

            // Get first few rules
            if (sheet.cssRules) {
              for (let i = 0; i < Math.min(5, sheet.cssRules.length); i++) {
                info.firstRules.push(sheet.cssRules[i].cssText?.substring(0, 100));
              }
            }

            results.stylesheets.push(info);
            results.totalRules += info.rules;

            // Check for Tailwind patterns
            if (sheet.cssRules) {
              for (let i = 0; i < Math.min(100, sheet.cssRules.length); i++) {
                const rule = sheet.cssRules[i];
                if (
                  rule.cssText &&
                  (rule.cssText.includes(".bg-") ||
                    rule.cssText.includes(".text-") ||
                    rule.cssText.includes(".flex") ||
                    rule.cssText.includes("--tw-"))
                ) {
                  results.tailwindDetected = true;
                  break;
                }
              }
            }
          } catch (e) {
            results.stylesheets.push({
              index: idx,
              href: sheet.href || "inline",
              error: e.message,
            });
          }
        });

        // Determine status
        if (results.totalRules > 1000 && results.tailwindDetected) {
          results.status = "good";
        } else if (results.totalRules > 100) {
          results.status = "warning";
        } else {
          results.status = "bad";
        }

        displayResults();
      }

      function displayResults() {
        const resultsDiv = document.getElementById("results");
        const detailsDiv = document.getElementById("details");

        let html = "";

        // Status
        const statusClass =
          results.status === "good"
            ? "status-good"
            : results.status === "warning"
              ? "status-warn"
              : "status-bad";
        html += `<h3 class="${statusClass}">Status: ${results.status.toUpperCase()}</h3>`;

        // Summary
        html += `<p><strong>Total Stylesheets:</strong> ${results.stylesheets.length}</p>`;
        html += `<p><strong>Total CSS Rules:</strong> ${results.totalRules}</p>`;
        html += `<p><strong>Tailwind Detected:</strong> ${results.tailwindDetected ? "‚úÖ Yes" : "‚ùå No"}</p>`;

        // Individual sheets
        html += "<h4>Stylesheet Details:</h4><ul>";
        results.stylesheets.forEach((sheet) => {
          const name =
            sheet.href === "inline" ? "inline" : new URL(sheet.href).pathname.split("/").pop();
          html += `<li><strong>${name}</strong>: ${sheet.rules || 0} rules`;
          if (sheet.error) {
            html += ` <span class="status-bad">(Error: ${sheet.error})</span>`;
          }
          html += "</li>";
        });
        html += "</ul>";

        // Recommendations
        if (results.status === "bad") {
          html += '<h4 class="status-bad">‚ö†Ô∏è Issues Found:</h4>';
          html += "<ul>";
          html += "<li>CSS has very few rules (expected: 1000+)</li>";
          html += "<li>This indicates Tailwind CSS did not build properly</li>";
          html += "<li>Likely cause: Vercel using cached broken build</li>";
          html += "</ul>";
          html += "<h4>Solution:</h4>";
          html += "<ol>";
          html += "<li>Clear Vercel build cache</li>";
          html += '<li>Redeploy with "Use existing build cache" UNCHECKED</li>';
          html += "<li>Wait for fresh build (~2-3 minutes)</li>";
          html += "<li>Hard refresh browser (Cmd+Shift+R / Ctrl+Shift+R)</li>";
          html += "</ol>";
        }

        resultsDiv.innerHTML = html;
        detailsDiv.textContent = JSON.stringify(results, null, 2);
      }

      async function fetchMainCSS() {
        const cssSheet = results.stylesheets.find(
          (s) => s.href && s.href.includes("index-") && s.href.includes(".css")
        );

        if (!cssSheet?.href) {
          alert("No main CSS file found");
          return;
        }

        try {
          const response = await fetch(cssSheet.href);
          const text = await response.text();
          const size = new Blob([text]).size;

          console.log("üìÑ CSS File Fetched:");
          console.log("  URL:", cssSheet.href);
          console.log("  Size:", (size / 1024).toFixed(2), "KB");
          console.log("  First 1000 chars:", text.substring(0, 1000));

          alert(`CSS file size: ${(size / 1024).toFixed(2)} KB\nCheck console for full details`);
        } catch (e) {
          alert("Error fetching CSS: " + e.message);
        }
      }

      function copyResults() {
        const text = JSON.stringify(results, null, 2);
        navigator.clipboard.writeText(text).then(() => {
          alert("Results copied to clipboard!");
        });
      }

      // Run analysis after page loads
      window.addEventListener("load", () => {
        setTimeout(analyzeCSS, 500);
      });
    </script>
  </body>
</html>
